<div class="sidebar-container" [class.collapsed]="isCollapsed && !isHovering" [class.hovering]="isHovering"
    [class.sidebar-light]="sidebarColor() === 'light'" [class.sidebar-dark]="sidebarColor() === 'dark'"
    (mouseenter)="onMouseEnter()" (mouseleave)="onMouseLeave()">
    <!-- Logo/Brand Section -->
    <div class="sidebar-header">
        <div class="logo" *ngIf="!isCollapsed || isHovering">
            <span class="logo-text">{{ 'app.title' | translate }}</span>
        </div>
        <div class="logo-icon" *ngIf="isCollapsed && !isHovering">
            <mat-icon>local_hospital</mat-icon>
        </div>
    </div>

    <!-- Menu Items -->
    <div class="menu-list">
        <ng-container *ngFor="let item of menuItems">
            <!-- Simple Link (no children) - EXPANDED -->
            <a class="menu-item" *ngIf="item.type === 'link' && (!isCollapsed || isHovering)" [routerLink]="item.route"
                routerLinkActive="active"
                [routerLinkActiveOptions]="{exact: item.route === '/dashboard' || item.route === '/'}">
                <mat-icon class="menu-icon">{{ item.icon || 'circle' }}</mat-icon>
                <span class="menu-text">{{ 'menu.' + item.name | translate }}</span>
                <span class="badge" *ngIf="item.badge" [style.background-color]="item.badge.color">
                    {{ item.badge.value }}
                </span>
            </a>

            <!-- Simple Link (no children) - COLLAPSED -->
            <a class="menu-item collapsed-item" *ngIf="item.type === 'link' && isCollapsed && !isHovering"
                [routerLink]="item.route" routerLinkActive="active"
                [routerLinkActiveOptions]="{exact: item.route === '/dashboard' || item.route === '/'}"
                [matTooltip]="'menu.' + item.name | translate" matTooltipPosition="right">
                <mat-icon class="menu-icon">{{ item.icon || 'circle' }}</mat-icon>
            </a>

            <!-- Submenu Level 1 (has children) - EXPANDED -->
            <mat-expansion-panel *ngIf="item.type === 'sub' && (!isCollapsed || isHovering)" class="submenu-panel">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <mat-icon class="menu-icon">{{ item.icon || 'folder' }}</mat-icon>
                        <span class="menu-text">{{ 'menu.' + item.name | translate }}</span>
                    </mat-panel-title>
                </mat-expansion-panel-header>

                <!-- Submenu Items Level 2 -->
                <div class="submenu-list">
                    <ng-container *ngFor="let subItem of item.children">
                        <!-- Level 2: Simple Link -->
                        <a class="submenu-item" *ngIf="subItem.type === 'link'" [routerLink]="subItem.route"
                            routerLinkActive="active">
                            <span class="submenu-text">{{ 'menu.' + subItem.name | translate }}</span>
                        </a>

                        <!-- Level 2: Nested Submenu -->
                        <mat-expansion-panel *ngIf="subItem.type === 'sub'" class="nested-panel">
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                    <mat-icon class="nested-icon" *ngIf="subItem.icon">{{ subItem.icon }}</mat-icon>
                                    <span class="nested-text">{{ 'menu.' + subItem.name | translate }}</span>
                                </mat-panel-title>
                            </mat-expansion-panel-header>

                            <!-- Level 3: Nested Items -->
                            <div class="nested-list">
                                <a class="nested-item" *ngFor="let nestedItem of subItem.children"
                                    [routerLink]="nestedItem.route" routerLinkActive="active">
                                    <span class="nested-item-text">{{ 'menu.' + nestedItem.name | translate }}</span>
                                </a>
                            </div>
                        </mat-expansion-panel>
                    </ng-container>
                </div>
            </mat-expansion-panel>

            <!-- Submenu (has children) - COLLAPSED -->
            <a class="menu-item collapsed-item" *ngIf="item.type === 'sub' && isCollapsed && !isHovering"
                [matTooltip]="'menu.' + item.name | translate" matTooltipPosition="right">
                <mat-icon class="menu-icon">{{ item.icon || 'folder' }}</mat-icon>
            </a>
        </ng-container>
    </div>
</div>