<div class="sidebar-container" [class.collapsed]="isCollapsed && !isHovering" [class.hovering]="isHovering"
    [class.sidebar-light]="sidebarColor() === 'light'" [class.sidebar-dark]="sidebarColor() === 'dark'"
    (mouseenter)="onMouseEnter()" (mouseleave)="onMouseLeave()">
    <!-- Logo/Brand Section -->
    <div class="sidebar-header">
        @if (!isCollapsed || isHovering) {
        <div class="logo">
            <span class="logo-text">{{ 'app.title' | translate }}</span>
        </div>
        }
        @if (isCollapsed && !isHovering) {
        <div class="logo-icon">
            <mat-icon>local_hospital</mat-icon>
        </div>
        }
    </div>

    <!-- Menu Items -->
    <div class="menu-list">
        @for (item of menuItems; track item.name) {
        <!-- Simple Link (no children) - EXPANDED -->
        @if (item.type === 'link' && (!isCollapsed || isHovering)) {
        <a class="menu-item" [routerLink]="item.route" routerLinkActive="active"
            [routerLinkActiveOptions]="{exact: item.route === '/dashboard' || item.route === '/'}"
            [matTooltip]="'menu.' + item.name | translate" matTooltipPosition="right">
            <mat-icon class="menu-icon">{{ item.icon || 'circle' }}</mat-icon>
            <span class="menu-text">{{ 'menu.' + item.name | translate }}</span>
            @if (item.badge) {
            <span class="badge" [style.background-color]="item.badge.color">
                {{ item.badge.value }}
            </span>
            }
        </a>
        }

        <!-- Simple Link (no children) - COLLAPSED -->
        @if (item.type === 'link' && isCollapsed && !isHovering) {
        <a class="menu-item collapsed-item" [routerLink]="item.route" routerLinkActive="active"
            [routerLinkActiveOptions]="{exact: item.route === '/dashboard' || item.route === '/'}"
            [matTooltip]="'menu.' + item.name | translate" matTooltipPosition="right">
            <mat-icon class="menu-icon">{{ item.icon || 'circle' }}</mat-icon>
        </a>
        }

        <!-- Submenu/Group Level 1 (has children) - EXPANDED -->
        @if ((item.type === 'sub' || item.type === 'group') && (!isCollapsed || isHovering)) {
        <mat-expansion-panel class="submenu-panel">
            <mat-expansion-panel-header [matTooltip]="'menu.' + item.name | translate" matTooltipPosition="right">
                <mat-panel-title>
                    <mat-icon class="menu-icon">{{ item.icon || 'folder' }}</mat-icon>
                    <span class="menu-text">{{ 'menu.' + item.name | translate }}</span>
                </mat-panel-title>
            </mat-expansion-panel-header>

            <!-- Submenu Items Level 2 -->
            <div class="submenu-list">
                @for (subItem of item.children; track subItem.name) {
                <!-- Level 2: Simple Link -->
                @if (subItem.type === 'link') {
                <a class="submenu-item" [routerLink]="subItem.route" routerLinkActive="active"
                    [matTooltip]="'menu.' + subItem.name | translate" matTooltipPosition="right">
                    <span class="submenu-text">{{ 'menu.' + subItem.name | translate }}</span>
                </a>
                }

                <!-- Level 2: Nested Submenu -->
                @if (subItem.type === 'sub' || subItem.type === 'group') {
                <mat-expansion-panel class="nested-panel">
                    <mat-expansion-panel-header [matTooltip]="'menu.' + subItem.name | translate"
                        matTooltipPosition="right">
                        <mat-panel-title>
                            @if (subItem.icon) {
                            <mat-icon class="nested-icon">{{ subItem.icon }}</mat-icon>
                            }
                            <span class="nested-text">{{ 'menu.' + subItem.name | translate }}</span>
                        </mat-panel-title>
                    </mat-expansion-panel-header>

                    <!-- Level 3: Nested Items -->
                    <div class="nested-list">
                        @for (nestedItem of subItem.children; track nestedItem.name) {
                        <a class="nested-item" [routerLink]="nestedItem.route" routerLinkActive="active"
                            [matTooltip]="'menu.' + nestedItem.name | translate" matTooltipPosition="right">
                            <span class="nested-item-text">{{ 'menu.' + nestedItem.name | translate }}</span>
                        </a>
                        }
                    </div>
                </mat-expansion-panel>
                }
                }
            </div>
        </mat-expansion-panel>
        }

        <!-- Submenu/Group (has children) - COLLAPSED -->
        @if ((item.type === 'sub' || item.type === 'group') && isCollapsed && !isHovering) {
        <a class="menu-item collapsed-item" [matTooltip]="'menu.' + item.name | translate" matTooltipPosition="right">
            <mat-icon class="menu-icon">{{ item.icon || 'folder' }}</mat-icon>
        </a>
        }
        }
    </div>
</div>