import { Meta, Markdown } from '@storybook/blocks';

<Meta title="Docs/Reactive Architecture" />

# 游 Reactive Accessibility Engine

El **Product Abstraction Layer (PAL)** no es solo una colecci칩n de componentes visuales; es un **motor sem치ntico** gobernado por **Angular Signals**. 

Su objetivo principal es garantizar que la accesibilidad (ARIA) sea **fused** (fundida) con el estado l칩gico, sin desfases temporales ni errores de sincronizaci칩n manual.

## El Flujo de Datos

El dise침o sigue el patr칩n de **Orquestador y 츼tomos**:

1.  **UiFormField (Orquestador)**: Centraliza la l칩gica de negocio (errores, hints, validaciones, IDs).
2.  **UiInput/UiSelectNative (츼tomos)**: Reciben el estado sem치ntico y lo inyectan en el DOM nativo.

```mermaid
graph TD
    A[Consumer Template] -- Signals / Inputs --> B(UiFormField)
    B -- Effect Injection --> C(Atom Component)
    C -- Native Binding --> D[Native HTML Element]
    D -- Screen Reader --> E(User)
```

## Arquitectura de Se침ales

Utilizamos **Signal Inputs** (`input()`) en `UiFormField` para asegurar que cualquier cambio en las propiedades (`label`, `error`, `required`) dispare instant치neamente un `effect()`.

### 1. Inyecci칩n de Estado
El orquestador inyecta las propiedades ARIA directamente en el componente 치tomo (que se obtiene mediante `@ContentChild`).

```typescript
// En UiFormFieldComponent
effect(() => {
  const atom = this.atom();
  if (atom) {
     atom.ariaRequired = this.required();
     atom.ariaInvalid = this.hasError();
     // ...
  }
});
```

### 2. Sincronizaci칩n en el 츼tomo
Los 치tomos implementan **setters reactivos** que llaman a `markForCheck()`. Esto garantiza que, incluso bajo `ChangeDetectionStrategy.OnPush`, la UI se actualice en el siguiente microtask.

```typescript
// En UiInputComponent
@Input() set ariaInvalid(val: boolean) {
  this._ariaInvalid.set(val);
  this.cdr.markForCheck();
}
```

## Beneficios
- **WCAG 2.1 AA by Default**: Un desarrollador no tiene que preocuparse por vincular IDs de errores; el motor lo hace autom치ticamente.
- **Rendimiento M치ximo**: Solo los componentes afectados por un cambio de se침al se re-renderizan.
- **Testabilidad Total**: El estado de accesibilidad se puede verificar mediante se침ales antes de llegar al DOM.
